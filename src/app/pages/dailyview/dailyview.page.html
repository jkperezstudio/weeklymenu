<ion-header [translucent]="true">
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-menu-button></ion-menu-button>
        </ion-buttons>
        <img class="icon-upper-bar" src="assets/sidebaricons/day.png" slot="start" width="32" height="32" />
        <ion-title>Daily View</ion-title>
    </ion-toolbar>
</ion-header>

<ion-content>
    <ion-card>
        <ion-card-header>
            <ion-card-title class="todaysmealstittle">Today's Meals</ion-card-title>

            <h3 class="todaysdate">{{ formattedDate }}</h3>

        </ion-card-header>

        <ion-card-content>
            <div *ngFor="let meal of meals">
                <ion-item-sliding *ngIf="meal && meal.name; else emptyMeal">
                    <ion-item>

                        <ion-checkbox slot="end" [checked]="meal.done" (ionChange)="toggleMealDone(meal)"
                            [ngClass]="getColorClass(meal)">
                        </ion-checkbox>

                        <ion-label (click)="openMealForm(meal)" [ngClass]="{'meal-done': meal.done}">
                            <h1 class="mealtype">{{ meal.mealtype}}</h1>
                            <h2 class="meal">{{ meal.name }}</h2>
                            <p *ngIf="meal.description">{{ meal.description }}</p>
                        </ion-label>
                    </ion-item>
                    <ion-item-options side="end">
                        <ion-item-option (click)="editMeal(meal)">Edit</ion-item-option>
                    </ion-item-options>
                </ion-item-sliding>

                <ng-template #emptyMeal>
                    <ion-item (click)="openMealForm(meal)">
                        <ion-label>
                            <h1 class="mealtype">{{ meal.mealtype}}</h1>
                            <h2 class="notmealyet">Add Meal</h2>
                        </ion-label>
                    </ion-item>
                </ng-template>
            </div>

            <ion-button expand="full" [disabled]="!isDayComplete()" (click)="finalizeDay()">
                Finalize Day
            </ion-button>



        </ion-card-content>
    </ion-card>

    <!--Sección del modal a partir de aquí-->

    <ion-modal #mealModal [isOpen]="isModalOpen" (didDismiss)="onModalDismiss($event)">
        <ng-template>
            <ion-header>
                <ion-toolbar>
                    <ion-title>{{ currentMeal.name ? 'Edit Meal' : 'Add Meal' }}</ion-title>
                </ion-toolbar>
            </ion-header>

            <!-- Usamos ion-content para el cuerpo del modal -->
            <ion-content class="modal-container">

                <ion-item fill="outline" lines="none">
                    <ion-input class="name" name="mealName" label="Name" placeholder="Enter meal name"
                        labelPlacement="floating" required fill="outline" [(ngModel)]="currentMeal.name"
                        (ionInput)="filterSuggestions()">
                    </ion-input>
                </ion-item>

                <!-- Lista de sugerencias -->
                <ion-list *ngIf="suggestions.length > 0" class="suggestion-list">
                    <ion-item button *ngFor="let suggestion of suggestions" (click)="selectSuggestion(suggestion)">
                        {{ suggestion.name }}
                    </ion-item>
                </ion-list>



                <ion-item class="score" lines="none">
                    <ion-label>Score</ion-label>
                    <ion-range name="mealScore" min="1" max="5" step="1" snaps="true" ticks="true"
                        [(ngModel)]="currentMeal.score"
                        [ngStyle]="{'--knob-background': getColorByScore(currentMeal.score)}">
                    </ion-range>
                </ion-item>

                <ion-item class="alarm" lines="none">
                    <ion-label>Defrosted Alarm?</ion-label>
                    <ion-toggle slot="end" name="reminderToggle" [(ngModel)]="currentMeal.reminder">
                    </ion-toggle>
                </ion-item>

                <ion-item class="delivery" lines="none">
                    <ion-label>Delivery?</ion-label>
                    <ion-toggle slot="end" name="reminderToggle" [(ngModel)]="currentMeal.reminder">
                    </ion-toggle>
                </ion-item>

                <!-- Botón Save suelto dentro de ion-content -->
                <ion-button class="savebutton" (click)="saveMeal()"
                    [disabled]="!currentMeal.name || !currentMeal.score">
                    SAVE
                </ion-button>

            </ion-content>
        </ng-template>
    </ion-modal>

</ion-content>